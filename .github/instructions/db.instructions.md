---
applyTo: "packages/db/**"
---
# Database Instructions
- Schemas are TypeScript using Drizzle ORM (`packages/db/schema/`)
- Always export types with `$inferSelect` and `$inferInsert`
- Migrations are SQL files generated by `pnpm db:generate`
- Never hand-write migrations â€” always use drizzle-kit generate
- All data access goes through repositories (`packages/db/repositories/`)
- Repositories take a Database instance in their constructor (dependency injection)
- Use `eq()`, `and()`, `or()` from drizzle-orm for query conditions
- Always include `updatedAt` timestamp updates in mutations
- Use UUID for primary keys (`uuid('id').primaryKey().defaultRandom()`)
- Test with real Postgres via Testcontainers (not SQLite mocks)
